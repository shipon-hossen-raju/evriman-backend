generator client {
  provider = "prisma-client-js"
}

// Database connection
datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// =======================================================
// ===================== Global Schema Start =============
// =======================================================

// ====================== User ======================
enum LoginType {
  USER
  PARTNER
}

enum VerificationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum UserRole {
  ADMIN
  PARTNER
  USER
  SUPER_ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  BLOCKED
}

model User {
  id              String     @id @default(auto()) @map("_id") @db.ObjectId
  userId          String     @unique
  fullName        String
  email           String     @unique
  otp             Int?
  expirationOtp   DateTime?
  password        String
  address         String
  role            UserRole   @default(USER)
  status          UserStatus @default(ACTIVE)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  loginType       LoginType  @default(USER)
  phoneNumber     String
  dob             DateTime
  idDocument      String? // URL to uploaded ID document
  referralCode    String?
  termsAccepted   Boolean    @default(false)
  privacyAccepted Boolean    @default(false)
  isVerified      Boolean    @default(false)
  isDeceased      Boolean    @default(false)

  offerCodes            UserOfferCode[]
  UserDynamicFieldValue UserDynamicFieldValue[]

  @@map("users")
}

// =======================================================
// ===================== Global Schema End ===============
// =======================================================

// =======================================================
// ===================== User Start ======================
// =======================================================

// ================ User Profile ================

// =======================================================
// ===================== User End =======================
// =======================================================

// =======================================================
// ===================== Admin Start =====================
// =======================================================

// ================ Subscription ================

type EligibilityJson {
  minAge Int
}

enum LevelId {
  Price_1
  Price_2
  Price_3
}

model SubscriptionPlan {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  contactLimit Int
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  pricingOptions PricingOption[]
  offerCodes     OfferCodeSubscriptionPlan[]

  @@map("subscriptions")
}

model PricingOption {
  id               String           @id @default(auto()) @map("_id") @db.ObjectId
  label            String
  levelId          LevelId
  amount           Float
  durationInMonths Int?
  eligibility      EligibilityJson?

  subscriptionPlan   SubscriptionPlan @relation(fields: [subscriptionPlanId], references: [id])
  subscriptionPlanId String           @db.ObjectId

  offerCodes OfferCodePricingOption[] @relation("OfferCodesForPricingOption")

  @@unique([levelId, subscriptionPlanId])
  @@map("pricing_options")
}

// ===================== Offer Codes ====================
enum DiscountType {
  PERCENTAGE
  FIXED
}

enum UserType {
  ALL
  PAID
  NON_PAID
  SELECTED
}

// offer code model
model OfferCode {
  id   String @id @default(auto()) @map("_id") @db.ObjectId
  code String @unique

  discountType  DiscountType
  discountValue Float

  userType    UserType
  targetUsers UserOfferCode[]

  expiresAt DateTime?

  applicablePlans       OfferCodeSubscriptionPlan[]
  pricingOptionsLevelId OfferCodePricingOption[]
  optionLevelId         LevelId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)

  @@map("offer_codes")
}

model OfferCodeSubscriptionPlan {
  id                 String           @id @default(auto()) @map("_id") @db.ObjectId
  offerCode          OfferCode        @relation(fields: [offerCodeId], references: [id])
  offerCodeId        String           @db.ObjectId
  subscriptionPlan   SubscriptionPlan @relation(fields: [subscriptionPlanId], references: [id])
  subscriptionPlanId String           @db.ObjectId

  @@map("offer_code_subscription_plan")
}

model OfferCodePricingOption {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  offerCode   OfferCode @relation(fields: [offerCodeId], references: [id])
  offerCodeId String    @db.ObjectId

  pricingOption   PricingOption @relation("OfferCodesForPricingOption", fields: [pricingOptionId], references: [id])
  pricingOptionId String        @db.ObjectId

  @@unique([offerCodeId, pricingOptionId])
  @@map("offer_code_pricing_option")
}

model UserOfferCode {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  user        User      @relation(fields: [userId], references: [id])
  userId      String    @db.ObjectId
  offerCode   OfferCode @relation(fields: [offerCodeId], references: [id])
  offerCodeId String    @db.ObjectId

  @@map("user_offer_codes")
}

// ===================== Tag Management ====================

enum DynamicFieldStatus {
  DRAFT
  PUBLISHED
}

enum DynamicFieldCategory {
  POST_TAGS
  CORE_TAGS
  KEY_INFORMATION_SECTIONS
}

enum DynamicFieldType {
  TEXT
  SELECT
  FILE
}

model DynamicField {
  id        String               @id @default(auto()) @map("_id") @db.ObjectId
  label     String
  fieldName String
  type      DynamicFieldType
  options   String[] // if type == select, will be an array; otherwise can be null
  status    DynamicFieldStatus
  category  DynamicFieldCategory
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt

  @@unique([fieldName, category])
  @@map("dynamic_field")
}

model UserDynamicFieldValue {
  id        String               @id @default(auto()) @map("_id") @db.ObjectId
  user      User                 @relation(fields: [userId], references: [id])
  userId    String               @db.ObjectId
  fieldName String
  value     String
  fieldType DynamicFieldType
  category  DynamicFieldCategory
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt

  @@map("dynamic_field_value")
}

// =======================================================
// ===================== Admin End =====================
// =======================================================
